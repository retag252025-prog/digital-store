<script>
if (localStorage.getItem("loggedIn") !== "true") {
    alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = "login.html";
}
</script>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø¯ÙØ¹</title>
<link rel="stylesheet" href="style.css">

<style>
.payment-box {
    max-width: 800px;
    margin: 25px auto;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

input, select {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
}

button {
    width: 100%;
    padding: 12px;
    background: #FF9900;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
}

.summary {
    background: #f7f7f7;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
}
</style>
</head>

<body>

<header class="header">
  <div class="logo" onclick="location.href='/'" style="cursor:pointer;">Digital Store</div>
  <div class="account">
    <a href="/cart.html">ğŸ›’ Ø§Ù„Ø³Ù„Ø© <span id="cart-count">0</span></a>
  </div>
</header>

<script>
// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
if (localStorage.getItem("loggedIn") !== "true") {
    alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = "login.html";
}
</script>

<div class="payment-box">

<h2>Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹</h2>

<h3>ğŸ“¦ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
<div class="summary" id="summary"></div>

<h3>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>

<input id="name" type="text" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
<input id="phone" type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
<input id="address" type="text" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required>

<h3>ğŸ’³ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>

<select id="method">
    <option value="vodafone">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
    <option value="fawry">ÙÙˆØ±ÙŠ</option>
    <option value="bank">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
</select>

<button onclick="confirmPayment()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹</button>

</div>

<script>
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø©
let cart = JSON.parse(localStorage.getItem("cart") || "[]");

// Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø©
let s = "";
let total = 0;

cart.forEach(item => {
    s += `<p>â€¢ ${item.name} â€” ${item.price} Ø¬Ù†ÙŠÙ‡</p>`;
    total += Number(item.price);
});

document.getElementById("summary").innerHTML = `
    ${s}
    <hr>
    <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬Ù†ÙŠÙ‡</h3>
`;

function confirmPayment() {
    let order = {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        address: document.getElementById("address").value,
        method: document.getElementById("method").value,
        items: cart,
        total: total,
        date: new Date().toLocaleString()
    };

    // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨
    localStorage.setItem("lastOrder", JSON.stringify(order));

    // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
    localStorage.removeItem("cart");

    window.location.href = "success.html";
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
function updateCartCount() {
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    document.getElementById("cart-count").innerText = cart.length;
}
updateCartCount();
</script>

</body>
</html>
